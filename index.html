<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Typing Speed Test</title>
    <style>
        :root {
            --background-color: #1a1a1a;
            --text-color: #e0e0e0;
            --subtle-text-color: #666;
            --primary-color: #f92672;
            --correct-color: #a6e22e;
            --error-color: var(--primary-color);
            --cursor-color: var(--primary-color);
            --container-bg: #222;
            --font-family: 'Fira Code', 'Courier New', Courier, monospace;
            --line-height: 2.2;
        }

        [data-theme='dracula'] {
            --background-color: #282a36;
            --text-color: #f8f8f2;
            --subtle-text-color: #6272a4;
            --primary-color: #ff79c6;
            --correct-color: #50fa7b;
            --error-color: #ff5555;
            --cursor-color: #f8f8f2;
            --container-bg: #22212c;
        }

        [data-theme='aether'] {
            --background-color: #101015;
            --text-color: #E2B792;
            --subtle-text-color: #4A3E4E;
            --primary-color: #9370DB;
            --correct-color: #DBA9A9;
            --cursor-color: var(--primary-color);
            --container-bg: #1a1a20;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            font-family: var(--font-family);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            text-align: center;
            transition: background-color 0.3s, color 0.3s;
        }

        #watermark {
            position: fixed;
            bottom: 10px;
            right: 15px;
            font-size: 0.8rem;
            opacity: 0.7;
            user-select: none;
            z-index: 100;
            transition: opacity 0.2s ease, color 0.2s ease;
        }

        #watermark a {
            color: var(--subtle-text-color);
            text-decoration: none;
            transition: color 0.2s ease;
        }
        
        #watermark:hover a {
            color: var(--text-color);
        }
        
        #watermark:hover {
            opacity: 1;
        }


        .container {
            width: 90%;
            max-width: 900px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
        }

        .settings {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem 2rem;
            color: var(--subtle-text-color);
        }
        
        .setting-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .setting-group button {
            background: none;
            border: none;
            color: var(--subtle-text-color);
            font-family: inherit;
            cursor: pointer;
            font-size: 1rem;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            transition: color 0.2s, background-color 0.2s;
        }
        
        .setting-group button.active {
            color: var(--primary-color);
            font-weight: bold;
        }
        .setting-group button:not(.active):hover {
            color: var(--text-color);
        }

        #theme-selector {
            background-color: var(--container-bg);
            color: var(--text-color);
            border: 1px solid var(--subtle-text-color);
            border-radius: 4px;
            padding: 0.3rem;
            font-family: inherit;
        }
        
        #custom-text-container {
            width: 100%;
        }

        #custom-text-input {
            width: 100%;
            height: 100px;
            background-color: var(--container-bg);
            color: var(--text-color);
            border: 1px solid var(--subtle-text-color);
            border-radius: 5px;
            padding: 0.75rem;
            font-family: inherit;
            font-size: 1rem;
            resize: vertical;
        }
        
        #typing-area {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            width: 100%;
            max-width: 600px;
            font-size: 1.5rem;
        }

        .words-container {
            font-size: 1.75rem;
            letter-spacing: 1px;
            line-height: var(--line-height);
            user-select: none;
            position: relative;
            max-height: calc(1.75rem * var(--line-height) * 3);
            overflow: hidden;
            transition: filter 0.3s ease;
        }
        
        .words-container.unfocused {
            filter: blur(4px);
        }
        
        .words-container.unfocused::after {
            content: 'Click to focus';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.2rem;
            color: var(--text-color);
            background: rgba(0,0,0,0.5);
            padding: 0.5rem 1rem;
            border-radius: 5px;
            z-index: 10;
        }

        #word-wrapper {
            transition: transform 0.3s ease-out;
        }
        
        #word-wrapper span {
            color: var(--subtle-text-color);
        }
        #word-wrapper span.correct { color: var(--text-color); }
        #word-wrapper span.incorrect { color: var(--error-color); text-decoration: underline; }

        #cursor {
            position: absolute;
            width: 3px;
            height: 2.5rem;
            background-color: var(--cursor-color);
            animation: blink 1s infinite;
            transition: left 0.1s ease, top 0.1s ease;
            border-radius: 2px;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        #typing-input {
            position: absolute;
            left: -9999px;
            opacity: 0;
        }

        .results {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
            width: 100%;
            max-width: 700px;
        }

        #result-wpm {
            font-size: 5rem;
            color: var(--correct-color);
            font-weight: bold;
        }
        
        #result-wpm .label {
            font-size: 2rem;
            color: var(--text-color);
            font-weight: normal;
            margin-left: 0.5rem;
        }

        .results-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem 3rem;
            width: 100%;
            max-width: 500px;
            font-size: 1.1rem;
        }
        
        .results-details div { color: var(--subtle-text-color); }
        .results-details span {
            display: block;
            font-size: 2rem;
            font-weight: bold;
            color: var(--text-color);
        }
        
        #result-chars .val { font-size: 1.5rem; color: var(--text-color); }
        #result-chars .correct { color: var(--correct-color); }
        #result-chars .incorrect { color: var(--error-color); }


        #restart-btn {
            background-color: var(--primary-color);
            color: var(--background-color);
            border: none;
            padding: 0.8rem 2rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.2rem;
            font-family: inherit;
            margin-top: 1rem;
            transition: transform 0.2s ease, opacity 0.2s ease;
        }

        #restart-btn:hover {
            opacity: 0.9;
            transform: scale(1.05);
        }
        
        @media (max-width: 768px) {
            .container { gap: 1.5rem; }
            .settings { flex-direction: column; gap: 1.5rem; }
            .stats { font-size: 1.2rem; }
            .words-container { font-size: 1.5rem; max-height: calc(1.5rem * var(--line-height) * 3); }
            #cursor { height: 2rem; }
            #result-wpm { font-size: 4rem; }
            #result-wpm .label { font-size: 1.5rem; }
            .results-details { grid-template-columns: 1fr; max-width: 300px; text-align: center;}
        }
    </style>
</head>
<body data-theme="dracula">

    <div class="container">
        
        <div class="settings">
            <div class="setting-group" id="time-settings">
                <span>Time:</span>
                <button data-time="15">15s</button>
                <button data-time="30">30s</button>
                <button data-time="60" class="active">60s</button>
                <button data-time="120">120s</button>
            </div>
            <div class="setting-group" id="mode-settings">
                <span>Mode:</span>
                <button data-mode="words" class="active">Words</button>
                <button data-mode="custom">Custom</button>
            </div>
            <div class="setting-group">
                <span>Theme:</span>
                <select id="theme-selector">
                    <option value="dark">Dark</option>
                    <option value="dracula">Dracula</option>
                    <option value="aether">Aether</option>
                </select>
            </div>
        </div>
        
        <div id="custom-text-container" style="display: none;">
            <textarea id="custom-text-input" placeholder="Paste your custom text here... The test will begin once you start typing below."></textarea>
        </div>
        
        <div id="typing-area">
            <div class="stats">
                <div id="timer">60</div>
                <div id="wpm">WPM: 0</div>
            </div>
            <div id="words-container" class="words-container unfocused">
                <div id="word-wrapper"></div>
                <div id="cursor"></div>
            </div>
        </div>
        <input type="text" id="typing-input" autofocus>

        <div id="results" class="results">
            <h2 id="result-wpm">0<span class="label">WPM</span></h2>
            <div class="results-details">
                <div>Test Config<span id="result-info">60s | words</span></div>
                <div>Accuracy<span id="result-accuracy">0%</span></div>
                <div>Raw WPM<span id="result-raw-wpm">0</span></div>
                <div id="result-chars">Characters<span class="val">
                    <span class="correct">0</span> / <span class="incorrect">0</span>
                </span></div>
            </div>
            <button id="restart-btn">Try Again</button>
        </div>
    </div>
    
    <div id="watermark">
        <a href="https://github.com/akshdeepsingh7/typing-test" target="_blank" rel="noopener noreferrer">akshdeepsingh7/typing-test</a>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const COMMON_WORDS = [
                'the', 'be', 'to', 'of', 'and', 'a', 'in', 'that', 'have', 'I', 'it', 'for', 'not', 'on', 'with', 'he', 'as', 'you', 'do', 'at', 'this', 'but', 'his', 'by', 'from', 'they', 'we', 'say', 'her', 'she', 'or', 'an', 'will', 'my', 'one', 'all', 'would', 'there', 'their', 'what', 'so', 'up', 'out', 'if', 'about', 'who', 'get', 'which', 'go', 'me', 'when', 'make', 'can', 'like', 'time', 'no', 'just', 'him', 'know', 'take', 'people', 'into', 'year', 'your', 'good', 'some', 'could', 'them', 'see', 'other', 'than', 'then', 'now', 'look', 'only', 'come', 'its', 'over', 'think', 'also', 'back', 'after', 'use', 'two', 'how', 'our', 'work', 'first', 'well', 'way', 'even', 'new', 'want', 'because', 'any', 'these', 'give', 'day', 'most', 'us', 'is', 'are', 'was', 'were', 'has', 'had', 'do', 'does', 'did', 'said', 'go', 'goes', 'went', 'gone', 'going', 'see', 'sees', 'saw', 'seen', 'seeing', 'come', 'comes', 'came', 'coming', 'get', 'gets', 'got', 'getting', 'make', 'makes', 'made', 'making', 'know', 'knows', 'knew', 'knowing', 'think', 'thinks', 'thought', 'thinking', 'take', 'takes', 'took', 'taken', 'taking', 'want', 'wants', 'wanted', 'wanting', 'look', 'looks', 'looked', 'looking', 'use', 'uses', 'used', 'using', 'find', 'finds', 'found', 'finding', 'give', 'gives', 'gave', 'given', 'giving', 'tell', 'tells', 'told', 'telling', 'work', 'works', 'worked', 'working', 'call', 'calls', 'called', 'calling', 'try', 'tries', 'tried', 'trying', 'ask', 'asks', 'asked', 'asking', 'need', 'needs', 'needed', 'needing', 'feel', 'feels', 'felt', 'feeling', 'become', 'becomes', 'became', 'becoming', 'leave', 'leaves', 'left', 'leaving', 'put', 'puts', 'putting', 'mean', 'means', 'meant', 'meaning', 'keep', 'keeps', 'kept', 'keeping', 'let', 'lets', 'letting', 'begin', 'begins', 'began', 'begun', 'beginning', 'seem', 'seems', 'seemed', 'seeming', 'help', 'helps', 'helped', 'helping', 'talk', 'talks', 'talked', 'talking', 'turn', 'turns', 'turned', 'turning', 'start', 'starts', 'started', 'starting', 'show', 'shows', 'showed', 'shown', 'showing', 'hear', 'hears', 'heard', 'hearing', 'play', 'plays', 'played', 'playing', 'run', 'runs', 'ran', 'running', 'move', 'moves', 'moved', 'moving', 'live', 'lives', 'lived', 'living', 'believe', 'believes', 'believed', 'believing', 'bring', 'brings', 'brought', 'bringing', 'happen', 'happens', 'happened', 'happening', 'write', 'writes', 'wrote', 'written', 'writing', 'provide', 'provides', 'provided', 'providing', 'sit', 'sits', 'sat', 'sitting', 'stand', 'stands', 'stood', 'standing', 'lose', 'loses', 'lost', 'losing', 'pay', 'pays', 'paid', 'paying', 'meet', 'meets', 'met', 'meeting', 'include', 'includes', 'included', 'including', 'continue', 'continues', 'continued', 'continuing', 'set', 'sets', 'setting', 'learn', 'learns', 'learned', 'learning', 'change', 'changes', 'changed', 'changing', 'lead', 'leads', 'led', 'leading', 'understand', 'understands', 'understood', 'understanding', 'watch', 'watches', 'watched', 'watching', 'follow', 'follows', 'followed', 'following', 'stop', 'stops', 'stopped', 'stopping', 'create', 'creates', 'created', 'creating', 'speak', 'speaks', 'spoke', 'spoken', 'speaking', 'read', 'reads', 'reading', 'allow', 'allows', 'allowed', 'allowing', 'add', 'adds', 'added', 'adding', 'spend', 'spends', 'spent', 'spending', 'grow', 'grows', 'grew', 'grown', 'growing', 'open', 'opens', 'opened', 'opening', 'walk', 'walks', 'walked', 'walking', 'win', 'wins', 'won', 'winning', 'offer', 'offers', 'offered', 'offering', 'remember', 'remembers', 'remembered', 'remembering', 'love', 'loves', 'loved', 'loving', 'consider', 'considers', 'considered', 'considering', 'appear', 'appears', 'appeared', 'appearing', 'buy', 'buys', 'bought', 'buying', 'wait', 'waits', 'waited', 'waiting', 'serve', 'serves', 'served', 'serving', 'die', 'dies', 'died', 'dying', 'send', 'sends', 'sent', 'sending', 'expect', 'expects', 'expected', 'expecting', 'build', 'builds', 'built', 'building', 'stay', 'stays', 'stayed', 'staying', 'fall', 'falls', 'fell', 'fallen', 'falling', 'cut', 'cuts', 'cutting', 'reach', 'reaches', 'reached', 'reaching', 'kill', 'kills', 'killed', 'killing', 'remain', 'remains', 'remained', 'remaining'
            ];
            const WPM_STANDARD_WORD_LENGTH = 5;

            const elements = {
                typingArea: document.getElementById('typing-area'),
                wordsContainer: document.getElementById('words-container'),
                wordWrapper: document.getElementById('word-wrapper'),
                typingInput: document.getElementById('typing-input'),
                timerEl: document.getElementById('timer'),
                wpmEl: document.getElementById('wpm'),
                resultsEl: document.getElementById('results'),
                restartBtn: document.getElementById('restart-btn'),
                cursor: document.getElementById('cursor'),
                timeSettings: document.getElementById('time-settings'),
                modeSettings: document.getElementById('mode-settings'),
                themeSelector: document.getElementById('theme-selector'),
                customTextContainer: document.getElementById('custom-text-container'),
                customTextInput: document.getElementById('custom-text-input'),
                resultWpm: document.querySelector('#result-wpm'),
                resultInfo: document.getElementById('result-info'),
                resultAccuracy: document.getElementById('result-accuracy'),
                resultRawWpm: document.getElementById('result-raw-wpm'),
                resultChars: document.getElementById('result-chars'),
            };

            let state = {
                timeLimit: 60,
                timeLeft: 60,
                testMode: 'words',
                charIndex: 0,
                correctChars: 0,
                incorrectChars: 0,
                isTestActive: false,
                timerInterval: null,
                currentText: '',
                currentLine: 0,
            };

            function init() {
                loadTheme();
                setupEventListeners();
                startGame();
            }

            function setupEventListeners() {
                document.addEventListener('keydown', () => elements.typingInput.focus());
                elements.wordsContainer.addEventListener('click', () => elements.typingInput.focus());
                elements.typingInput.addEventListener('input', handleTyping);
                elements.typingInput.addEventListener('keydown', handleBackspace);
                elements.typingInput.addEventListener('focus', () => elements.wordsContainer.classList.remove('unfocused'));
                elements.typingInput.addEventListener('blur', () => elements.wordsContainer.classList.add('unfocused'));
                
                elements.restartBtn.addEventListener('click', startGame);

                elements.timeSettings.addEventListener('click', (e) => {
                    if (e.target.tagName === 'BUTTON') {
                        state.timeLimit = parseInt(e.target.dataset.time, 10);
                        document.querySelector('#time-settings .active').classList.remove('active');
                        e.target.classList.add('active');
                        startGame();
                    }
                });

                elements.modeSettings.addEventListener('click', (e) => {
                    if (e.target.tagName === 'BUTTON') {
                        state.testMode = e.target.dataset.mode;
                        document.querySelector('#mode-settings .active').classList.remove('active');
                        e.target.classList.add('active');
                        elements.customTextContainer.style.display = state.testMode === 'custom' ? 'block' : 'none';
                        startGame();
                    }
                });

                elements.themeSelector.addEventListener('change', (e) => setTheme(e.target.value));
            }

            function startGame() {
                clearInterval(state.timerInterval);
                Object.assign(state, {
                    timeLeft: state.timeLimit,
                    charIndex: 0, correctChars: 0, incorrectChars: 0,
                    isTestActive: false,
                    currentLine: 0,
                });
                
                elements.timerEl.textContent = state.timeLeft;
                elements.wpmEl.textContent = 'WPM: 0';
                elements.resultsEl.style.display = 'none';
                elements.typingArea.style.display = 'flex';
                elements.typingInput.value = '';
                elements.wordWrapper.style.transform = 'translateY(0px)';
                
                generateText();
                renderText();
                updateCursorPosition();
                elements.typingInput.focus();
            }
            
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            function generateText() {
                if (state.testMode === 'custom') {
                    state.currentText = elements.customTextInput.value.trim().replace(/\s+/g, ' ') || 'Please enter custom text above to begin.';
                } else {
                    state.currentText = shuffleArray([...COMMON_WORDS]).slice(0, 200).join(' ');
                }
            }
            
            function renderText() {
                elements.wordWrapper.innerHTML = '';
                state.currentText.split('').forEach(char => {
                    const charSpan = document.createElement('span');
                    charSpan.innerText = char;
                    elements.wordWrapper.appendChild(charSpan);
                });
            }

            function handleTyping(e) {
                if (state.timeLeft === 0) return;
                if (!state.isTestActive) startTimer();

                const typedValue = elements.typingInput.value;
                const charSpans = elements.wordWrapper.querySelectorAll('span');
                
                const typedChar = typedValue.slice(-1);
                
                if (state.charIndex < charSpans.length) {
                    const expectedChar = charSpans[state.charIndex].innerText;
                    
                    if (typedChar === expectedChar) {
                        charSpans[state.charIndex].classList.add('correct');
                        state.correctChars++;
                    } else {
                        charSpans[state.charIndex].classList.add('incorrect');
                        state.incorrectChars++;
                    }
                    state.charIndex++;
                }

                updateCursorPosition();
                updateWPM();
                
                if (state.charIndex === charSpans.length) endGame();
            }

            function handleBackspace(e) {
                if (e.key !== 'Backspace' || state.charIndex === 0) return;
                
                e.preventDefault();
                state.charIndex--;
                elements.typingInput.value = elements.typingInput.value.slice(0, -1);
                
                const span = elements.wordWrapper.querySelectorAll('span')[state.charIndex];
                if (span.classList.contains('correct')) state.correctChars--;
                else if (span.classList.contains('incorrect')) state.incorrectChars--;
                span.classList.remove('correct', 'incorrect');
                
                updateCursorPosition();
            }

            function startTimer() {
                state.isTestActive = true;
                state.timerInterval = setInterval(() => {
                    state.timeLeft--;
                    elements.timerEl.textContent = state.timeLeft;
                    updateWPM();
                    if (state.timeLeft === 0) endGame();
                }, 1000);
            }

            function updateWPM() {
                if (!state.isTestActive) return;
                const timeElapsed = (state.timeLimit - state.timeLeft) / 60;
                if (timeElapsed > 0) {
                    const netWPM = Math.round((state.correctChars / WPM_STANDARD_WORD_LENGTH) / timeElapsed);
                    elements.wpmEl.textContent = `WPM: ${netWPM}`;
                }
            }

            function updateCursorPosition() {
                const charSpans = elements.wordWrapper.querySelectorAll('span');
                if (state.charIndex >= charSpans.length) return;

                const span = charSpans[state.charIndex];
                const spanRect = span.getBoundingClientRect();
                const containerRect = elements.wordsContainer.getBoundingClientRect();

                elements.cursor.style.top = `${span.offsetTop}px`;
                elements.cursor.style.left = `${span.offsetLeft}px`;

                const lineHeight = parseFloat(getComputedStyle(elements.wordsContainer).fontSize) * 1.75;
                const currentLine = Math.floor(span.offsetTop / lineHeight);

                if (currentLine > state.currentLine && currentLine > 1) {
                    state.currentLine = currentLine;
                    const scrollAmount = -(currentLine - 1) * lineHeight * 1.25;
                     elements.wordWrapper.style.transform = `translateY(${scrollAmount}px)`;
                }
            }

            function endGame() {
                clearInterval(state.timerInterval);
                state.isTestActive = false;
                elements.typingInput.blur();
                elements.typingArea.style.display = 'none';

                const timeTakenMin = (state.timeLimit - (state.timeLeft || 0)) / 60;
                const totalCharsTyped = state.correctChars + state.incorrectChars;
                
                const netWPM = timeTakenMin > 0 ? Math.round((state.correctChars / WPM_STANDARD_WORD_LENGTH) / timeTakenMin) : 0;
                const rawWPM = timeTakenMin > 0 ? Math.round((totalCharsTyped / WPM_STANDARD_WORD_LENGTH) / timeTakenMin) : 0;
                const accuracy = totalCharsTyped > 0 ? Math.round((state.correctChars / totalCharsTyped) * 100) : 0;

                elements.resultWpm.innerHTML = `${netWPM}<span class="label">WPM</span>`;
                elements.resultInfo.textContent = `${state.timeLimit}s | ${state.testMode}`;
                elements.resultAccuracy.textContent = `${accuracy}%`;
                elements.resultRawWpm.textContent = rawWPM;
                elements.resultChars.innerHTML = `Characters<span class="val">
                    <span class="correct">${state.correctChars}</span> / <span class="incorrect">${state.incorrectChars}</span>
                </span>`;

                elements.resultsEl.style.display = 'flex';
            }

            function setTheme(themeName) {
                document.body.dataset.theme = themeName;
                localStorage.setItem('typingTestTheme', themeName);
            }

            function loadTheme() {
                const savedTheme = localStorage.getItem('typingTestTheme') || 'dracula';
                elements.themeSelector.value = savedTheme;
                setTheme(savedTheme);
            }

            init();
        });
    </script>
</body>
</html>
